{% macro add_transaction(banks, categories, today) %}
    <div id="new-transaction-modal" class="modal">
        <form id="new-transaction-form">
            <div class="modal-content">
                <h4><i class="material-icons">add_circle</i> Ajouter une nouvelle transaction</h4>

                <!--Category-->
                <div class="input-field col m4 s12">
                    <i id="transaction-cat-icon" class="fa {{ categories[0].icon }} prefix" aria-hidden="true"></i>
                    <select name="cat" id="transaction-cat">
                        {% for category in categories | sort(attribute='name') %}
                        <option value="{{ category.category_id }}" data-material-icon="{{ category.icon }}" class="circle">{{ category.name }}</option>
                        {% endfor %}
                    </select>
                    <label>Catégorie</label>
                </div>

                <!--Description-->
                <div class="input-field col m8 s12">
                    <i class="material-icons prefix">textsms</i>
                    <input name="desc" id="transaction-description" placeholder="Optionnel, utilisera le nom de la catégorie si vide." type="text" class="validate" data-length="256" pattern="^.{0,256}$">
                    <label for="transaction-description" data-error="La description ne doit pas dépasser 256 caractères.">Description</label>
                </div>

                <!--Amount-->
                <div class="input-field col m4 s12">
                    <i class="material-icons prefix">attach_money</i>
                    <input name="amount" id="transaction-amount" type="text" pattern="[0-9]+(\.[0-9]{1,2})?" class="validate" required>
                    <label for="transaction-amount" data-error="Veuillez entrer un montant comme 123 ou 456.50">Montant</label>
                </div>

                <!--Date-->
                <div class="input-field col m4 s12">
                    <i class="material-icons prefix">date_range</i>
                    <input name="date" id="transaction-date" value="{{ today }}" type="text" pattern="[0-9]{1,2}-[0-9]{1,2}-[12][0-9]{3}" class="validate">
                    <label for="transaction-date" data-error="Veuillez entrer une date en utilisant le format DD-MM-AAAA">Date</label>
                </div>

                <!--Bank-->
                <div class="input-field col m4 s12">
                    <i id="transaction-bank-icon" class="material-icons prefix" style="color:#{{ banks[0].color }}">account_balance</i>
                    <select name="bank" id="transaction-bank">
                        {% for bank in banks | sort(attribute='name') %}
                        <option value="{{ bank.bank_id }}" data-color="{{ bank.color }}">{{ bank.name }}</option>
                        {% endfor %}
                    </select>
                    <label>Banque</label>
                </div>

                <!--<div class="col m12 s12 switch center-align" style="line-height:5">-->
                    <!--<label>-->
                    <!--Select Category-->
                    <!--<input type="checkbox" name="selectCategory" disabled="">-->
                    <!--<span class="lever"></span>-->
                    <!--Use Suggested Category-->
                    <!--</label>-->
                <!--</div>-->

                <!--<div class="input-field col m6">-->
                    <!--<input name="suggestedCategory" id="suggested-category" type="text" disabled="" value="Category">-->
                    <!--<label for="suggested-category">Suggested Category</label>-->
                <!--</div>-->

            </div>
            <div class="modal-footer">
                <button type="submit" class="waves-effect btn" style="margin-left:6px">
                    <i class="material-icons left">add</i> Ajouter
                </button>
                <button type="button" class="modal-action modal-close waves-effect btn-flat">Annuler</button>
            </div>
        </form>
    </div>
    <script type="text/javascript">
        $(document).ready(function() {
            /** Change the current category icon when selecting a new value */
            $("#transaction-cat").change(function(e) {
                var parentSelect = $(e.target).closest(".select-wrapper"),
                    currentValue = $("select", parentSelect).val(),
                    currentIcon = $("select option[value='"+currentValue+"']", parentSelect).data('material-icon');
                document.getElementById("transaction-cat-icon").className = "fa prefix " + currentIcon;
            });

            /** Change the current bank icon color according to the new value */
            $("#transaction-bank").change(function(e) {
                var parentSelect = $(e.target).closest(".select-wrapper"),
                    currentValue = $("select", parentSelect).val(),
                    currentColor = $("select option[value='"+currentValue+"']", parentSelect).data('color');
                $("#transaction-bank-icon").css('color', "#"+currentColor);
            });
        });
    </script>
{% endmacro %}


{% macro add_transaction_js() %}
    function addTransaction(bankId) {
        var form = $("#new-transaction-form");
        form.trigger('reset');
        $("[name='bank']", form).val(bankId).change().material_select();
        $("#new-transaction-modal").modal('open');
    }

    $("#new-transaction-form").submit(function (event) {
        event.preventDefault();
        var url = "{{ url_for('budgeto_services.add_transaction') }}",
            data = $(this).serialize(),
            errorMessage = "Une erreur s'est produite pendant l'ajout de la transaction. SVP essayez plus tard.";

        endless.post(url, data, errorMessage).done(function() {
            $("#new-transaction-modal").modal('close');
            location.reload();
        });
    });
{% endmacro %}


{% macro category_options() %}
    <div id="category-options" class="modal bottom-sheet">
        <form id="category-options-form">
            <div class="modal-content">
                <input type="hidden" name="cat">
                <h4>
                    <i id="category-icon" class="fa" aria-hidden="true"></i>
                    <span id="category-title"></span>
                </h4>

                <div class="switch col m4 offset-m2 s12 center-align" style="line-height:5">
                    <label>
                        Pas de limite
                        <input name="setLimit" id="category-limit-lever" type="checkbox">
                        <span class="lever"></span>
                        Définir une limite pour cette catégorie
                    </label>
                </div>

                <div class="input-field col m6 s12">
                    <i class="material-icons prefix">attach_money</i>
                    <input name="limit" id="category-limit" type="text" pattern="[0-9]+(\.[0-9]{1,2})?" class="validate" required disabled>
                    <label for="transaction-amount" data-error="SVP Entrez une limite d'argent comme 1000 ou 10.50$.">Limite</label>
                </div>
            </div>
            <div class="modal-footer">
                <button type="submit" class="waves-effect btn" style="margin-left:6px">
                    <i class="material-icons left">save</i> Sauvegarder
                </button>
                <button type="button" class="modal-action modal-close waves-effect btn-flat">Annuler</button>
            </div>
        </form>
    </div>
    <script type="text/javascript">
        $(document).ready(function() {
            /** Enable/disable limit setter */
            $("#category-limit-lever").change(function() {
                var isEnabled = $(this).is(':checked');
                $("#category-limit").prop('disabled', !isEnabled);
            });
        });
    </script>
{% endmacro %}



{% macro warning_message() %}
<div id="warning-modal" class="modal">
    <form id="warning-form">
        <div class="modal-content">
            <input type="hidden" name="id">
            <p>Êtes-vous certain de vouloir supprimer cette transaction?</p>
        </div>
        <div class="modal-footer">
            <button type="submit" class="waves-effect btn" style="margin-left:6px">
                <i class="material-icons left">check</i> Oui
            </button>
            <button type="button" class="modal-action modal-close waves-effect btn-flat">Non</button>
        </div>
    </form>
</div>
{% endmacro %}